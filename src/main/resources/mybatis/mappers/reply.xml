<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.Reply">
	<resultMap type="replyVO" id="replyResult">
		<result property="num" column="num" />
		<result property="postnum" column="postnum" />
		<result property="communityname" column="communityname" />
		<result property="replycontent" column="replycontent" />
		<result property="writedate" column="writedate" />
		<result property="nickname" column="nickname" />
		<result property="replygroup_num" column="replygroup_num" />
		<result property="replytype" column="replytype" />
		<result property="status" column="status" />
		<result property="image" column="image" />
	</resultMap>

	<!-- 댓글 리스트 -->
	<select id="replyList" parameterType="replyVO" resultMap="replyResult">
		select re.num, re.postnum, re.communityname , re.replycontent, re.writedate, re.nickname, 
			   re.replygroup_num, re.replytype, re.status, mem.image from reply as re left outer join member as mem on re.nickname = mem.nickname 
			   where re.communityname = #{communityname} and re.postnum = #{postnum} and re.replytype = 0 order by writedate desc;
	</select>
	
	<!-- 대댓글 리스트 -->
	<select id="replyList2" parameterType="replyVO" resultMap="replyResult">
		select re.num, re.postnum, re.communityname , re.replycontent, re.writedate, re.nickname, 
			   re.replygroup_num, re.replytype, re.status, mem.image from reply as re left outer join member as mem on re.nickname = mem.nickname 
			   where re.communityname = #{communityname} and re.postnum = #{postnum} and re.replytype = 1 order by writedate desc;
	</select>
	
	<!-- 댓글 등록 -->
	<insert id="replywrite" parameterType="replyVO">
		<selectKey resultType="int" keyProperty="replygroup_num" order="BEFORE">
			SELECT IFNULL(MAX(num+1),1) FROM reply;
		</selectKey>
		insert into reply (postnum, communityname, replycontent, nickname, replygroup_num, replytype)
		values (#{postnum}, #{communityname}, #{replycontent}, #{nickname}, #{replygroup_num}, #{replytype});
	</insert>
	

</mapper>